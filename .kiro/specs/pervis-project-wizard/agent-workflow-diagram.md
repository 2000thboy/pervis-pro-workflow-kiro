# Agent 协作流程图示

本文档展示 Pervis PRO 导演工作台中 Agent 的完整协作流程，从用户输入项目开始到最终输出。

---

## 零、完整项目流程总览（从输入到输出）

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    Pervis PRO 完整项目流程                                          │
│                                    (从用户输入到最终输出)                                           │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                      │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║                                      用户输入                                                  ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                                      │
│       ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │
│       │  剧本文件   │    │  基本信息   │    │  参考素材   │    │  项目设定   │                     │
│       │ (TXT/PDF/   │    │ (标题/类型/ │    │ (图片/视频/ │    │ (时长/画幅/ │                     │
│       │  DOCX/FDX)  │    │  预算)      │    │  文档)      │    │  帧率)      │                     │
│       └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                     │
│              │                  │                  │                  │                             │
│              └──────────────────┴──────────────────┴──────────────────┘                             │
│                                         │                                                            │
│                                         ▼                                                            │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║  阶段 1: 项目立项 (Project Wizard)                                                            ║ │
│  ║                                                                                                ║ │
│  ║  ┌─────────────────────────────────────────────────────────────────────────────────────────┐ ║ │
│  ║  │                              Agent 协作流程                                              │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   用户上传 ──▶ Script_Agent ──▶ Director_Agent ──▶ 用户确认                            │ ║ │
│  ║  │              (剧本解析)      (审核)                                                      │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   用户上传 ──▶ Art_Agent ──▶ Director_Agent ──▶ 用户确认                               │ ║ │
│  ║  │              (素材处理)    (审核)                                                        │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   PM_Agent (隐藏): 记录项目规格、版本历史、用户决策                                     │ ║ │
│  ║  └─────────────────────────────────────────────────────────────────────────────────────────┘ ║ │
│  ║                                                                                                ║ │
│  ║  输出: 项目档案 (剧本结构、角色列表、场次大纲、参考素材库)                                   ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                         │                                                            │
│                                         ▼                                                            │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║  阶段 2: 故事板 (Beatboard)                                                                   ║ │
│  ║                                                                                                ║ │
│  ║  ┌─────────────────────────────────────────────────────────────────────────────────────────┐ ║ │
│  ║  │                              Agent 协作流程                                              │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   项目信息 ──▶ Art_Agent ──▶ Director_Agent ──▶ 用户确认                               │ ║ │
│  ║  │   打包        (素材召回)    (审核匹配)                                                   │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   流程: 场次描述 → 生成搜索词条 → 向量匹配 → 召回素材 → 装配故事板                     │ ║ │
│  ║  └─────────────────────────────────────────────────────────────────────────────────────────┘ ║ │
│  ║                                                                                                ║ │
│  ║  输出: 完整故事板 (每个场次的镜头序列和参考素材)                                             ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                         │                                                            │
│                                         ▼                                                            │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║  阶段 3: 时间线 (Timeline)                                                                    ║ │
│  ║                                                                                                ║ │
│  ║  ┌─────────────────────────────────────────────────────────────────────────────────────────┐ ║ │
│  ║  │   故事板 → 时间线转换 → 用户剪辑调整 → 预览渲染                                        │ ║ │
│  ║  │                                                                                          │ ║ │
│  ║  │   Director_Agent: 审核剪辑结果                                                          │ ║ │
│  ║  │   PM_Agent: 记录版本                                                                    │ ║ │
│  ║  └─────────────────────────────────────────────────────────────────────────────────────────┘ ║ │
│  ║                                                                                                ║ │
│  ║  输出: 可预览的时间线 (带音视频的完整序列)                                                   ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                         │                                                            │
│                                         ▼                                                            │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║  阶段 4: 导出 (Export)                                                                        ║ │
│  ║                                                                                                ║ │
│  ║  ┌─────────────────────────────────────────────────────────────────────────────────────────┐ ║ │
│  ║  │   PM_Agent: 提供项目规格用于导出设置                                                    │ ║ │
│  ║  │   System_Agent: 监控导出进度，处理问题                                                  │ ║ │
│  ║  └─────────────────────────────────────────────────────────────────────────────────────────┘ ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                         │                                                            │
│                                         ▼                                                            │
│  ╔═══════════════════════════════════════════════════════════════════════════════════════════════╗ │
│  ║                                      最终输出                                                  ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                                      │
│       ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │
│       │  项目文档   │    │  故事板序列 │    │  视频/音频  │    │  NLE 工程   │                     │
│       │ (PDF/DOCX)  │    │ (PNG/JPG)   │    │ (MP4/WAV)   │    │ (XML/EDL)   │                     │
│       └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                     │
│                                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 一、整体架构概览

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Pervis PRO 导演工作台                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                           用户界面 (Frontend)                            │   │
│   │   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐      │   │
│   │   │ 立项    │→│ 分析    │→│ 故事板  │→│ 时间线  │→│ 导出    │      │   │
│   │   │ Wizard  │  │Analysis │  │Beatboard│  │Timeline │  │ Export  │      │   │
│   │   └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘      │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                           │
│                                      │ REST API                                  │
│                                      ▼                                           │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                          Agent 服务层 (Backend)                          │   │
│   │                                                                          │   │
│   │   ┌───────────────┐  ┌───────────────┐  ┌───────────────┐              │   │
│   │   │ Script_Agent  │  │  Art_Agent    │  │Director_Agent │              │   │
│   │   │   (编剧)      │  │   (美术)      │  │   (导演)      │              │   │
│   │   │               │  │               │  │               │              │   │
│   │   │ • 剧本解析    │  │ • 文件分类    │  │ • 审核输出    │              │   │
│   │   │ • 内容生成    │  │ • 标签生成    │  │ • 一致性检查  │              │   │
│   │   │ • 时长估算    │  │ • 缩略图生成  │  │ • 版本对比    │              │   │
│   │   └───────┬───────┘  └───────┬───────┘  └───────┬───────┘              │   │
│   │           │                  │                  │                       │   │
│   │           └──────────────────┼──────────────────┘                       │   │
│   │                              │                                           │   │
│   │                              ▼                                           │   │
│   │                    ┌───────────────────┐                                │   │
│   │                    │    PM_Agent       │  ← 隐藏，后台运行              │   │
│   │                    │   (项目管理)      │                                │   │
│   │                    │                   │                                │   │
│   │                    │ • 项目规格管理    │                                │   │
│   │                    │ • 版本记录        │                                │   │
│   │                    │ • 用户决策记录    │                                │   │
│   │                    └───────────────────┘                                │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```


## 二、完整工作流程（从用户输入到输出）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         完整工作流程                                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ╔═══════════════════════════════════════════════════════════════════════════╗  │
│  ║  阶段 1: 项目立项 (Project Wizard)                                        ║  │
│  ╚═══════════════════════════════════════════════════════════════════════════╝  │
│                                                                                  │
│  ┌─────────────┐                                                                │
│  │   用户      │                                                                │
│  │  输入/上传  │                                                                │
│  └──────┬──────┘                                                                │
│         │                                                                        │
│         │ ① 上传剧本文件                                                        │
│         │ ② 填写基本信息（标题、类型、时长、画幅）                              │
│         │ ③ 上传参考素材                                                        │
│         ▼                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                          │   │
│  │   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐      │   │
│  │   │Script_Agent │         │  Art_Agent  │         │  PM_Agent   │      │   │
│  │   │   (编剧)    │         │   (美术)    │         │ (项目管理)  │      │   │
│  │   └──────┬──────┘         └──────┬──────┘         └──────┬──────┘      │   │
│  │          │                       │                       │              │   │
│  │          │ 解析剧本              │ 处理素材              │ 记录规格    │   │
│  │          │ • 提取场次            │ • 生成缩略图          │ • 时长      │   │
│  │          │ • 提取角色            │ • 提取元数据          │ • 画幅      │   │
│  │          │ • 分析结构            │ • 生成标签            │ • 帧率      │   │
│  │          ▼                       ▼                       ▼              │   │
│  │   ┌─────────────────────────────────────────────────────────────┐      │   │
│  │   │                    Director_Agent (导演)                     │      │   │
│  │   │                                                              │      │   │
│  │   │  审核流程:                                                   │      │   │
│  │   │  ① 规则校验 (内容完整性)                                    │      │   │
│  │   │  ② 项目规格一致性 (从 PM_Agent 获取)                        │      │   │
│  │   │  ③ 艺术风格一致性                                           │      │   │
│  │   │  ④ 历史版本对比                                             │      │   │
│  │   │                                                              │      │   │
│  │   │  输出: ✅ 审核通过 / ⚠️ 建议修改                            │      │   │
│  │   └──────────────────────────┬──────────────────────────────────┘      │   │
│  │                              │                                          │   │
│  └──────────────────────────────┼──────────────────────────────────────────┘   │
│                                 │                                               │
│                                 ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         用户确认                                         │   │
│  │                                                                          │   │
│  │   显示: "编剧 Agent 完成" → "导演 Agent 审核通过"                       │   │
│  │                                                                          │   │
│  │   用户选择: [接受] [修改] [重新生成]                                    │   │
│  │                                                                          │   │
│  │   → PM_Agent 记录用户决策                                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 三、单个任务的 Agent 协作详细流程

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    示例: 生成人物小传                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  用户点击 "生成人物小传" 按钮                                                   │
│         │                                                                        │
│         ▼                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Step 1: PM_Agent 提供上下文                                             │   │
│  │                                                                          │   │
│  │  PM_Agent.get_project_context() 返回:                                   │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ ProjectContext {                                                 │   │   │
│  │  │   specs: { duration: 1800, aspect_ratio: "16:9", fps: 24 }      │   │   │
│  │  │   style: { description: "赛博朋克风格", mood: "紧张悬疑" }       │   │   │
│  │  │   version_history: [ v1: "...", v2: "..." ]                     │   │   │
│  │  │   user_decisions: [ { v1: "rejected", reason: "太长" } ]        │   │   │
│  │  │ }                                                                │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│         │                                                                        │
│         ▼                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Step 2: Script_Agent 生成内容                                           │   │
│  │                                                                          │   │
│  │  前端显示: "🖊️ 编剧 Agent 正在工作..."                                  │   │
│  │                                                                          │   │
│  │  Script_Agent.generate_character_bio(                                   │   │
│  │    character_name="张三",                                               │   │
│  │    script=剧本内容,                                                     │   │
│  │    context=ProjectContext                                               │   │
│  │  )                                                                       │   │
│  │                                                                          │   │
│  │  输出: "张三，35岁，前特工，性格冷酷但内心善良..."                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│         │                                                                        │
│         ▼                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Step 3: Director_Agent 审核                                             │   │
│  │                                                                          │   │
│  │  前端显示: "🎬 导演 Agent 审核中..."                                    │   │
│  │                                                                          │   │
│  │  Director_Agent.review() 执行:                                          │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ ① 规则校验                                                       │   │   │
│  │  │    ✅ 内容不为空                                                 │   │   │
│  │  │    ✅ 字数: 150字 (合理范围 50-500)                              │   │   │
│  │  │    ✅ 格式正确                                                   │   │   │
│  │  ├─────────────────────────────────────────────────────────────────┤   │   │
│  │  │ ② 项目规格一致性                                                 │   │   │
│  │  │    ✅ 角色设定符合项目时长 (30分钟短片)                          │   │   │
│  │  ├─────────────────────────────────────────────────────────────────┤   │   │
│  │  │ ③ 艺术风格一致性 (LLM 检查)                                      │   │   │
│  │  │    ✅ "前特工"设定符合"赛博朋克"风格                             │   │   │
│  │  │    ✅ "冷酷但内心善良"符合"紧张悬疑"情绪                         │   │   │
│  │  ├─────────────────────────────────────────────────────────────────┤   │   │
│  │  │ ④ 历史版本对比                                                   │   │   │
│  │  │    ✅ 与 v1 (被否决) 不同                                        │   │   │
│  │  │    ✅ 比 v1 更简洁 (用户反馈"太长")                              │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  审核结果: ✅ 通过                                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│         │                                                                        │
│         ▼                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Step 4: 返回用户 & 记录                                                 │   │
│  │                                                                          │   │
│  │  前端显示: "✅ 导演 Agent 审核通过"                                     │   │
│  │                                                                          │   │
│  │  显示生成结果，用户可以:                                                │   │
│  │  [接受] → PM_Agent.record_decision("accepted")                          │   │
│  │  [修改] → 用户编辑后 PM_Agent.record_decision("modified")               │   │
│  │  [重新生成] → 回到 Step 2                                               │   │
│  │                                                                          │   │
│  │  PM_Agent.record_version() 记录本次生成的版本                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```


## 四、Agent 数据流向图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Agent 数据流向                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│                              ┌─────────────┐                                    │
│                              │   用户输入   │                                    │
│                              └──────┬──────┘                                    │
│                                     │                                            │
│         ┌───────────────────────────┼───────────────────────────┐               │
│         │                           │                           │               │
│         ▼                           ▼                           ▼               │
│  ┌─────────────┐           ┌─────────────┐           ┌─────────────┐           │
│  │   剧本文件   │           │  基本信息   │           │  参考素材   │           │
│  └──────┬──────┘           └──────┬──────┘           └──────┬──────┘           │
│         │                         │                         │                   │
│         ▼                         ▼                         ▼                   │
│  ┌─────────────┐           ┌─────────────┐           ┌─────────────┐           │
│  │Script_Agent │           │  PM_Agent   │           │  Art_Agent  │           │
│  │             │           │             │           │             │           │
│  │ 输出:       │           │ 存储:       │           │ 输出:       │           │
│  │ • 场次列表  │           │ • 项目规格  │           │ • 缩略图    │           │
│  │ • 角色列表  │           │ • 版本历史  │           │ • 元数据    │           │
│  │ • 结构分析  │           │ • 用户决策  │           │ • 标签      │           │
│  └──────┬──────┘           └──────┬──────┘           └──────┬──────┘           │
│         │                         │                         │                   │
│         │                         │ 提供上下文              │                   │
│         │                         ▼                         │                   │
│         │              ┌─────────────────────┐              │                   │
│         └─────────────▶│   Director_Agent    │◀─────────────┘                   │
│                        │                     │                                   │
│                        │  接收:              │                                   │
│                        │  • Agent 输出       │                                   │
│                        │  • 项目上下文       │                                   │
│                        │                     │                                   │
│                        │  执行:              │                                   │
│                        │  • 规则校验         │                                   │
│                        │  • 一致性检查       │                                   │
│                        │  • 版本对比         │                                   │
│                        │                     │                                   │
│                        │  输出:              │                                   │
│                        │  • 审核结果         │                                   │
│                        │  • 改进建议         │                                   │
│                        └──────────┬──────────┘                                   │
│                                   │                                              │
│                                   ▼                                              │
│                        ┌─────────────────────┐                                   │
│                        │      用户确认       │                                   │
│                        │                     │                                   │
│                        │  [接受] [修改] [重新生成]                              │
│                        └──────────┬──────────┘                                   │
│                                   │                                              │
│                                   │ 记录决策                                     │
│                                   ▼                                              │
│                        ┌─────────────────────┐                                   │
│                        │     PM_Agent        │                                   │
│                        │   记录版本和决策    │                                   │
│                        └─────────────────────┘                                   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 五、完整项目生命周期中的 Agent 参与

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        项目生命周期 Agent 参与图                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  阶段 1: 项目立项 (Project Wizard)                                       │   │
│  │                                                                          │   │
│  │  参与 Agent:                                                             │   │
│  │  • Script_Agent - 剧本解析、内容生成                                    │   │
│  │  • Art_Agent - 素材处理、标签生成                                       │   │
│  │  • Director_Agent - 审核所有输出                                        │   │
│  │  • PM_Agent - 记录项目规格和版本 (隐藏)                                 │   │
│  │                                                                          │   │
│  │  输出: 完整的项目档案 (剧本、角色、场次、参考素材)                      │   │
│  └──────────────────────────────────┬──────────────────────────────────────┘   │
│                                     │                                           │
│                                     │ 项目信息打包                              │
│                                     ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  阶段 2: 故事板 (Beatboard)                                              │   │
│  │                                                                          │   │
│  │  参与 Agent:                                                             │   │
│  │  • Art_Agent - 从素材库召回匹配的参考素材                               │   │
│  │  • Director_Agent - 审核素材匹配结果                                    │   │
│  │  • PM_Agent - 记录版本 (隐藏)                                           │   │
│  │                                                                          │   │
│  │  流程:                                                                   │   │
│  │  ① 基于场次描述生成搜索词条                                             │   │
│  │  ② 从素材库召回匹配的参考素材                                           │   │
│  │  ③ Director_Agent 审核匹配结果                                          │   │
│  │  ④ 用户确认/替换素材                                                    │   │
│  │  ⑤ 装配到故事板                                                         │   │
│  │                                                                          │   │
│  │  输出: 完整的故事板 (每个场次的镜头和参考素材)                          │   │
│  └──────────────────────────────────┬──────────────────────────────────────┘   │
│                                     │                                           │
│                                     │ 故事板数据                                │
│                                     ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  阶段 3: 时间线 (Timeline)                                               │   │
│  │                                                                          │   │
│  │  参与 Agent:                                                             │   │
│  │  • Director_Agent - 审核剪辑结果                                        │   │
│  │  • PM_Agent - 记录版本 (隐藏)                                           │   │
│  │                                                                          │   │
│  │  流程:                                                                   │   │
│  │  ① 将故事板转换为时间线                                                 │   │
│  │  ② 用户调整剪辑                                                         │   │
│  │  ③ 预览渲染                                                             │   │
│  │                                                                          │   │
│  │  输出: 可预览的时间线                                                   │   │
│  └──────────────────────────────────┬──────────────────────────────────────┘   │
│                                     │                                           │
│                                     │ 时间线数据                                │
│                                     ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  阶段 4: 导出 (Export)                                                   │   │
│  │                                                                          │   │
│  │  参与 Agent:                                                             │   │
│  │  • PM_Agent - 提供项目规格用于导出设置 (隐藏)                           │   │
│  │                                                                          │   │
│  │  导出选项:                                                               │   │
│  │  • 项目文档 (PDF/DOCX)                                                  │   │
│  │  • 故事板序列 (PNG/JPG)                                                 │   │
│  │  • 视频/音频 (MP4/WAV)                                                  │   │
│  │  • NLE 工程 (XML/EDL)                                                   │   │
│  │                                                                          │   │
│  │  输出: 最终交付物                                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```


## 六、Agent 状态显示时序图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        前端 Agent 状态显示时序                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  时间轴 ──────────────────────────────────────────────────────────────────────▶ │
│                                                                                  │
│  用户操作    │ 点击"生成人物小传"                                               │
│             │                                                                    │
│             ▼                                                                    │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  前端显示                                                                 │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│  │
│  │  │ 🖊️ 编剧 Agent 正在工作...                                          ││  │
│  │  │ ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 20%   ││  │
│  │  │                                                                      ││  │
│  │  │ 正在分析角色 "张三" 的行为和对话...                                 ││  │
│  │  └─────────────────────────────────────────────────────────────────────┘│  │
│  │                                                                           │  │
│  │                              ↓ 2-5秒后                                    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│  │
│  │  │ 🖊️ 编剧 Agent 正在工作...                                          ││  │
│  │  │ ████████████████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 60%   ││  │
│  │  │                                                                      ││  │
│  │  │ 正在生成人物小传...                                                 ││  │
│  │  └─────────────────────────────────────────────────────────────────────┘│  │
│  │                                                                           │  │
│  │                              ↓ 2-3秒后                                    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│  │
│  │  │ 🎬 导演 Agent 审核中...                                             ││  │
│  │  │ ████████████████████████████████████████████████░░░░░░░░░░░░ 80%   ││  │
│  │  │                                                                      ││  │
│  │  │ 正在检查与项目风格的一致性...                                       ││  │
│  │  └─────────────────────────────────────────────────────────────────────┘│  │
│  │                                                                           │  │
│  │                              ↓ 1-2秒后                                    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│  │
│  │  │ ✅ 导演 Agent 审核通过                                              ││  │
│  │  │ ████████████████████████████████████████████████████████████ 100%  ││  │
│  │  │                                                                      ││  │
│  │  │ 人物小传已生成，请确认                                              ││  │
│  │  └─────────────────────────────────────────────────────────────────────┘│  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│  │
│  │  │ 生成结果:                                                           ││  │
│  │  │                                                                      ││  │
│  │  │ 张三，35岁，前特工，性格冷酷但内心善良。曾在国际情报机构工作十年，  ││  │
│  │  │ 因一次任务失败导致搭档牺牲，从此退出江湖。如今在城市边缘开了一家    ││  │
│  │  │ 小酒馆，试图忘记过去...                                             ││  │
│  │  │                                                                      ││  │
│  │  │ 来源: Script_Agent                                                  ││  │
│  │  │                                                                      ││  │
│  │  │ [接受]  [修改]  [重新生成]                                          ││  │
│  │  └─────────────────────────────────────────────────────────────────────┘│  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 七、Director_Agent 审核建议示例

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                     Director_Agent 审核建议示例                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  场景 1: 审核通过                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 导演 Agent 审核通过                                                   │   │
│  │                                                                          │   │
│  │ 审核详情:                                                                │   │
│  │ • 规则校验: ✅ 通过                                                     │   │
│  │ • 项目规格一致性: ✅ 符合 30 分钟短片设定                               │   │
│  │ • 艺术风格一致性: ✅ 符合赛博朋克风格                                   │   │
│  │ • 历史版本对比: ✅ 与被否决版本不同                                     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  场景 2: 审核通过但有建议                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ ⚠️ 导演 Agent 审核通过，但有改进建议                                    │   │
│  │                                                                          │   │
│  │ 审核详情:                                                                │   │
│  │ • 规则校验: ✅ 通过                                                     │   │
│  │ • 项目规格一致性: ✅ 通过                                               │   │
│  │ • 艺术风格一致性: ⚠️ 建议调整                                          │   │
│  │ • 历史版本对比: ✅ 通过                                                 │   │
│  │                                                                          │   │
│  │ 改进建议:                                                                │   │
│  │ "角色背景设定偏向传统动作片风格，建议增加一些赛博朋克元素，             │   │
│  │  例如可以提及角色的机械义肢或神经接口等科技元素。"                       │   │
│  │                                                                          │   │
│  │ [接受当前版本]  [采纳建议重新生成]                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  场景 3: 检测到与历史版本相似                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ ⚠️ 导演 Agent 发现问题                                                  │   │
│  │                                                                          │   │
│  │ 审核详情:                                                                │   │
│  │ • 规则校验: ✅ 通过                                                     │   │
│  │ • 项目规格一致性: ✅ 通过                                               │   │
│  │ • 艺术风格一致性: ✅ 通过                                               │   │
│  │ • 历史版本对比: ❌ 与被否决版本相似                                     │   │
│  │                                                                          │   │
│  │ 问题说明:                                                                │   │
│  │ "当前生成的人物小传与版本 1 相似度达 85%。                              │   │
│  │  版本 1 被否决原因: '描述太长，缺乏重点'                                │   │
│  │  建议: 精简描述，突出角色核心特征。"                                    │   │
│  │                                                                          │   │
│  │ [强制接受]  [重新生成]                                                  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 八、PM_Agent 数据存储结构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        PM_Agent 数据存储结构                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  ProjectSpecs (项目规格)                                                 │   │
│  │                                                                          │   │
│  │  project_id: "proj_001"                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ duration: 1800          # 时长 (秒)                              │   │   │
│  │  │ aspect_ratio: "16:9"    # 画幅                                   │   │   │
│  │  │ frame_rate: 24          # 帧率                                   │   │   │
│  │  │ resolution: "1920x1080" # 分辨率                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  StyleContext (艺术风格)                                                 │   │
│  │                                                                          │   │
│  │  project_id: "proj_001"                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ description: "赛博朋克风格，霓虹灯光，雨夜城市"                  │   │   │
│  │  │ reference_projects: ["银翼杀手", "攻壳机动队"]                   │   │   │
│  │  │ color_palette: ["#00FFFF", "#FF00FF", "#0000FF"]                 │   │   │
│  │  │ mood: "紧张悬疑，带有一丝忧郁"                                   │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  ContentVersions (版本历史)                                              │   │
│  │                                                                          │   │
│  │  project_id: "proj_001"                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ version_id: "v1"                                                 │   │   │
│  │  │ content_type: "character_bio"                                    │   │   │
│  │  │ target_id: "char_001" (张三)                                     │   │   │
│  │  │ content: "张三，35岁，前特工，曾在国际情报机构工作..."           │   │   │
│  │  │ agent: "script_agent"                                            │   │   │
│  │  │ created_at: "2024-12-24 10:00:00"                                │   │   │
│  │  ├─────────────────────────────────────────────────────────────────┤   │   │
│  │  │ version_id: "v2"                                                 │   │   │
│  │  │ content_type: "character_bio"                                    │   │   │
│  │  │ target_id: "char_001" (张三)                                     │   │   │
│  │  │ content: "张三，35岁，前特工，性格冷酷但内心善良..."             │   │   │
│  │  │ agent: "script_agent"                                            │   │   │
│  │  │ created_at: "2024-12-24 10:05:00"                                │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  UserDecisions (用户决策)                                                │   │
│  │                                                                          │   │
│  │  project_id: "proj_001"                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ decision_id: "dec_001"                                           │   │   │
│  │  │ version_id: "v1"                                                 │   │   │
│  │  │ decision: "rejected"                                             │   │   │
│  │  │ feedback: "描述太长，缺乏重点"                                   │   │   │
│  │  │ created_at: "2024-12-24 10:02:00"                                │   │   │
│  │  ├─────────────────────────────────────────────────────────────────┤   │   │
│  │  │ decision_id: "dec_002"                                           │   │   │
│  │  │ version_id: "v2"                                                 │   │   │
│  │  │ decision: "accepted"                                             │   │   │
│  │  │ feedback: null                                                   │   │   │
│  │  │ created_at: "2024-12-24 10:07:00"                                │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 九、Agent 协作总结

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Agent 协作总结                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Agent 职责分工                                                          │   │
│  │                                                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │Script_Agent │  │  Art_Agent  │  │Director_Agent│ │  PM_Agent   │    │   │
│  │  │   (编剧)    │  │   (美术)    │  │   (导演)    │  │ (项目管理) │    │   │
│  │  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤    │   │
│  │  │ • 剧本解析  │  │ • 文件分类  │  │ • 审核输出  │  │ • 规格管理 │    │   │
│  │  │ • 内容生成  │  │ • 标签生成  │  │ • 一致性检查│  │ • 版本记录 │    │   │
│  │  │ • 时长估算  │  │ • 缩略图    │  │ • 版本对比  │  │ • 决策记录 │    │   │
│  │  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤    │   │
│  │  │ 用户可见    │  │ 用户可见    │  │ 用户可见    │  │ 隐藏运行   │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  协作流程                                                                │   │
│  │                                                                          │   │
│  │  用户触发任务                                                            │   │
│  │       │                                                                  │   │
│  │       ▼                                                                  │   │
│  │  PM_Agent 提供项目上下文 ─────────────────────────────────┐             │   │
│  │       │                                                    │             │   │
│  │       ▼                                                    │             │   │
│  │  Script_Agent / Art_Agent 执行任务 ◀──────────────────────┘             │   │
│  │       │                                                                  │   │
│  │       ▼                                                                  │   │
│  │  Director_Agent 审核 (参考 PM_Agent 提供的上下文)                       │   │
│  │       │                                                                  │   │
│  │       ▼                                                                  │   │
│  │  返回用户确认                                                            │   │
│  │       │                                                                  │   │
│  │       ▼                                                                  │   │
│  │  PM_Agent 记录版本和决策                                                │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  用户体验目标                                                            │   │
│  │                                                                          │   │
│  │  ✅ 给用户感觉有一个一直跟进项目的导演                                  │   │
│  │  ✅ 导演懂项目基本属性（时长、画幅、风格）                              │   │
│  │  ✅ 导演记得之前的决策，不会改着改着改回第一版                          │   │
│  │  ✅ 每个 Agent 的工作状态清晰可见                                       │   │
│  │  ✅ 用户始终有最终决定权                                                │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```


---

## 十、System_Agent 与其他 Agent 的协作

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    System_Agent 与其他 Agent 的协作                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         System_Agent (系统 Agent)                        │   │
│  │                         常驻运行，监控所有活动                           │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  悬浮 UI (右下角)                                                │   │   │
│  │  │                                                                  │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │ 🔵 系统状态: 工作中                                      │   │   │   │
│  │  │  │                                                          │   │   │   │
│  │  │  │ 当前任务:                                                │   │   │   │
│  │  │  │ • 🖊️ 编剧 Agent 正在工作... 45%                         │   │   │   │
│  │  │  │ • 📤 导出视频 30%                                        │   │   │   │
│  │  │  │                                                          │   │   │   │
│  │  │  │ 通知:                                                    │   │   │   │
│  │  │  │ • 🟡 存储空间不足 [清理缓存]                            │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                          │
│                                      │ WebSocket 事件                           │
│                                      │                                          │
│         ┌────────────────────────────┼────────────────────────────┐            │
│         │                            │                            │            │
│         ▼                            ▼                            ▼            │
│  ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐    │
│  │  AgentService   │        │  ExportService  │        │  HealthChecker  │    │
│  │                 │        │                 │        │                 │    │
│  │ emit:           │        │ emit:           │        │ emit:           │    │
│  │ agent.working   │        │ task.started    │        │ system.warning  │    │
│  │ agent.reviewing │        │ task.progress   │        │ system.error    │    │
│  │ agent.completed │        │ task.completed  │        │ storage.low     │    │
│  └────────┬────────┘        └────────┬────────┘        └────────┬────────┘    │
│           │                          │                          │              │
│           │                          │                          │              │
│           ▼                          ▼                          ▼              │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           EventService                                   │   │
│  │                                                                          │   │
│  │  • 管理 WebSocket 连接                                                  │   │
│  │  • 广播事件到所有客户端                                                 │   │
│  │  • 事件队列管理                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 十一、完整 Agent 协作时序图（单个任务）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    完整 Agent 协作时序图                                         │
│                    (以"生成人物小传"为例)                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  时间 ──────────────────────────────────────────────────────────────────────▶   │
│                                                                                  │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │  用户   │  │PM_Agent │  │Script   │  │Director │  │Event    │  │System   │ │
│  │         │  │(隐藏)   │  │Agent    │  │Agent    │  │Service  │  │Agent UI │ │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘ │
│       │            │            │            │            │            │       │
│       │ 点击"生成人物小传"      │            │            │            │       │
│       │────────────────────────▶│            │            │            │       │
│       │            │            │            │            │            │       │
│       │            │ 获取项目上下文          │            │            │       │
│       │            │◀───────────│            │            │            │       │
│       │            │            │            │            │            │       │
│       │            │ 返回 ProjectContext     │            │            │       │
│       │            │───────────▶│            │            │            │       │
│       │            │            │            │            │            │       │
│       │            │            │ emit("agent.working")   │            │       │
│       │            │            │───────────────────────▶│            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │ WebSocket  │       │
│       │            │            │            │            │───────────▶│       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │  显示:     │       │
│       │            │            │            │            │  "编剧 Agent│       │
│       │            │            │            │            │   正在工作" │       │
│       │            │            │            │            │            │       │
│       │            │            │ 生成人物小传            │            │       │
│       │            │            │ (LLM 调用)│            │            │       │
│       │            │            │            │            │            │       │
│       │            │            │ 完成，提交审核          │            │       │
│       │            │            │───────────▶│            │            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │ emit("agent.reviewing") │       │
│       │            │            │            │───────────▶│            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │ WebSocket  │       │
│       │            │            │            │            │───────────▶│       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │  显示:     │       │
│       │            │            │            │            │  "导演 Agent│       │
│       │            │            │            │            │   审核中"  │       │
│       │            │            │            │            │            │       │
│       │            │ 获取历史版本            │            │            │       │
│       │            │◀───────────────────────│            │            │       │
│       │            │            │            │            │            │       │
│       │            │ 返回版本历史和用户决策  │            │            │       │
│       │            │───────────────────────▶│            │            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │ 审核:      │            │       │
│       │            │            │            │ 1.规则校验 │            │       │
│       │            │            │            │ 2.规格一致 │            │       │
│       │            │            │            │ 3.风格一致 │            │       │
│       │            │            │            │ 4.版本对比 │            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │ emit("agent.completed") │       │
│       │            │            │            │───────────▶│            │       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │ WebSocket  │       │
│       │            │            │            │            │───────────▶│       │
│       │            │            │            │            │            │       │
│       │            │            │            │            │  显示:     │       │
│       │            │            │            │            │  "审核通过" │       │
│       │            │            │            │            │  + 结果    │       │
│       │            │            │            │            │            │       │
│       │◀───────────────────────────────────────────────────────────────│       │
│       │            │            │            │            │  用户看到  │       │
│       │            │            │            │            │  生成结果  │       │
│       │            │            │            │            │            │       │
│       │ 用户点击"接受"          │            │            │            │       │
│       │────────────▶│            │            │            │            │       │
│       │            │            │            │            │            │       │
│       │            │ 记录版本和决策          │            │            │       │
│       │            │ (accepted) │            │            │            │       │
│       │            │            │            │            │            │       │
│       │◀───────────│            │            │            │            │       │
│       │  完成      │            │            │            │            │       │
│       │            │            │            │            │            │       │
│  └────┴────┘  └────┴────┘  └────┴────┘  └────┴────┘  └────┴────┘  └────┴────┘ │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 十二、Agent 职责与通信方式总结

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        Agent 职责与通信方式总结                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Agent 列表                                                              │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Script_Agent (编剧 Agent)                                       │   │   │
│  │  │  ├── 职责: 剧本解析、内容生成、时长估算                         │   │   │
│  │  │  ├── 可见性: ✅ 用户可见                                        │   │   │
│  │  │  └── 状态显示: "编剧 Agent 正在工作..."                         │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Art_Agent (美术 Agent)                                          │   │   │
│  │  │  ├── 职责: 文件分类、标签生成、缩略图生成、素材召回             │   │   │
│  │  │  ├── 可见性: ✅ 用户可见                                        │   │   │
│  │  │  └── 状态显示: "美术 Agent 正在工作..."                         │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Director_Agent (导演 Agent)                                     │   │   │
│  │  │  ├── 职责: 审核输出、一致性检查、版本对比                       │   │   │
│  │  │  ├── 可见性: ✅ 用户可见                                        │   │   │
│  │  │  ├── 状态显示: "导演 Agent 审核中..."                           │   │   │
│  │  │  └── 特点: 有项目记忆，了解项目规格和历史决策                   │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  PM_Agent (项目管理 Agent)                                       │   │   │
│  │  │  ├── 职责: 项目规格管理、版本记录、用户决策记录                 │   │   │
│  │  │  ├── 可见性: ❌ 隐藏运行                                        │   │   │
│  │  │  └── 特点: 为 Director_Agent 提供项目上下文                     │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  System_Agent (系统 Agent)                                       │   │   │
│  │  │  ├── 职责: 任务监控、问题提示、健康检查                         │   │   │
│  │  │  ├── 可见性: ✅ 用户可见 (悬浮 UI)                              │   │   │
│  │  │  └── 特点: 常驻运行，实时推送状态                               │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  通信方式                                                                │   │
│  │                                                                          │   │
│  │  MVP 阶段:                                                              │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  前端 ◀──── REST API + 轮询 ────▶ 后端 AgentService             │   │   │
│  │  │  前端 ◀──── WebSocket ────▶ 后端 EventService (System_Agent)    │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  │  后续迁移:                                                              │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  前端 ◀──── WebSocket ────▶ 后端 (所有 Agent 实时通信)          │   │   │
│  │  │  Agent 间 ◀──── 消息总线 ────▶ Agent (multi-agent-workflow)     │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

