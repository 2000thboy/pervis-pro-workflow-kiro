# 启动器重构与系统架构设计 (V2.0 - 秋叶风格版)

## 🎯 核心理念：Akiya-Style (秋叶风格)
参考行业标杆 "秋叶启动器"，我们将产品定位调整为 **"全能环境管家"**。
不仅是开关，更是系统的**运维中心 (Operations Center)**。

## 1. 功能分布矩阵 (Feature Matrix)

| 功能模块 | 🖥️ 启动器 (Launcher) | 🌐 浏览器 (Web UI) | 同步机制 |
| :--- | :--- | :--- | :--- |
| **素材库路径** | ✅ **读写** (添加/删除挂载点) | ✅ **读写** (添加/删除挂载点) | **双向同步** (共享 Config 文件) |
| **素材预处理** | ✅ **批量执行** (独立进程，不依赖浏览器) | ✅ **后台任务** (上传时触发) | 共享数据库状态 |
| **输出路径** | ✅ **设置** (全局默认) | ❌ 仅使用 | 启动器主导 |
| **版本管理** | ✅ **核心** (内核/依赖/插件更新) | ❌ 无权限 | - |
| **环境修复** | ✅ **一键修复** (Git/Pip/Cuda) | ❌ 无权限 | - |
| **标签管理** | ❌ 仅展示 | ✅ **深度编辑** (管理 Taxonomy) | - |

---

## 2. 深度功能规格

### A. 启动器：环境与预处理 (The "Ops" Side)
新版启动器将包含以下从"秋叶"借鉴的核心页签：

1.  **🏠 一键启动 (Home)**
    - 大按钮：启动/停止。
    - 实时日志：滚动的控制台输出（黑底白字）。
    - 显存/内存监控仪表盘。

2.  **💾 路径与预处理 (Assets & Processing)**
    - **路径管理**：列表显示当前监控的 NAS/本地 路径。
    - **预处理中心**：
        - 类似于 "Batch Pre-process" 按钮。
        - 场景：用户刚把 NAS 挂载上，点击 "全量扫描并生成代理"，此时不需要打开浏览器，启动器独立跑完进度条。
        - 状态显示：`扫描中: 50% | 缩略图生成: 200/500`。

3.  **🧩 版本与扩展 (Versions & Extensions)**
    - **内核管理**：显示 Python 版本、PyTorch 版本、FFmpeg 版本。
    - **扩展管理**：列出当前安装的插件 (如 `autocut`, `ocr`, `speech`)。
    - **更新按钮**：`Git Pull` 拉取最新代码。

4.  **⚙️ 高级设置 (Settings)**
    - 监听端口 (8000/3000)。
    - 默认输出目录 (`Z:\Renders`).
    - 显卡指定 (CUDA_VISIBLE_DEVICES).

### B. 浏览器：创意与交互 (The "Creative" Side)
1.  **资源库设置**：
    - 在 Web 的 "设置" 面板中，也允许用户添加路径。
    - 逻辑：前端调用 API -> 后端修改配置文件 -> 启动器界面若打开则自动刷新 (或下次打开刷新)。
    
2.  **标签管理**：
    - 启动器只管"文件在哪里"，浏览器管"文件是什么"。
    - 所有的 Tagging、AI 分析结果修正，都在 Web 端完成。

---

## 3. 技术实现要点

### 数据一致性 (Single Source of Truth)
- **配置文件**: `config/system.json` (存储路径、版本号、偏好设置)。
- **读写逻辑**:
    - 启动器启动时读取 `system.json`。
    - Web 端通过 API (`/api/config`) 读写该文件。
    - 确保两端看到的"路径列表"永远一致。

### 预处理独立性
- 预处理脚本 (`services/asset_processor.py`) 必须设计为**可独立运行**。
- 启动器可以直接调用 `python -m services.asset_processor --scan_all`，而不依赖 FastAPI 服务是否启动。
- 这样实现了"离线维护"的能力。

## 4. 下一步行动 (Planlist)
1.  **配置中心化**: 创建 `backend/config/system_config_manager.py`，统一管理 JSON 读写。
2.  **启动器 UI 升级**: 在现有 `Control Center` 基础上增加 "版本管理" 和 "高级设置" 页签。
3.  **API 扩展**: 后端增加配置读写接口，供 Web 端调用。

此方案确保了您想要的 "专业运维" (启动器) 与 "便捷操作" (Web) 的完美结合。
