# AI æŒ‰é’®åŠŸèƒ½æ£€æµ‹æŠ¥å‘Š

**æ£€æµ‹æ—¶é—´**: 2025-12-24 (æ›´æ–°)
**æ£€æµ‹ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡ - æ‰€æœ‰ AI åŠŸèƒ½å‡è°ƒç”¨çœŸå®åç«¯ API

---

## ä¸€ã€æ£€æµ‹æ¦‚è¦

| æ£€æµ‹é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å‰ç«¯ Mock æ•°æ® | âœ… å·²åˆ é™¤ | `geminiService-backup.ts` å·²åˆ é™¤ |
| åç«¯ Mock æ•°æ® | âœ… æ—  | `ai.py` è·¯ç”±æ— ç¡¬ç¼–ç è¿”å› |
| LLM Provider | âœ… çœŸå®è°ƒç”¨ | æ”¯æŒ Ollama (æœ¬åœ°) å’Œ Gemini (äº‘ç«¯) |
| API ç«¯ç‚¹ | âœ… å®Œæ•´ | æ‰€æœ‰ AI åŠŸèƒ½å‡æœ‰å¯¹åº”åç«¯ç«¯ç‚¹ |
| æœåŠ¡é€‰æ‹© | âœ… æ–°å¢ | æ”¯æŒè‡ªåŠ¨æ£€æµ‹å’Œæ‰‹åŠ¨åˆ‡æ¢ AI æœåŠ¡ |

---

## äºŒã€AI æœåŠ¡é€‰æ‹©åŠŸèƒ½ (æ–°å¢)

### é…ç½®é€‰é¡¹

| é…ç½®å€¼ | è¯´æ˜ |
|--------|------|
| `auto` | è‡ªåŠ¨æ£€æµ‹å¯ç”¨æœåŠ¡ (ä¼˜å…ˆæœ¬åœ° Ollamaï¼Œå›é€€åˆ° Gemini) |
| `ollama` / `local` | ä½¿ç”¨æœ¬åœ° Ollama æœåŠ¡ |
| `gemini` | ä½¿ç”¨ Google Gemini API |

### æ–°å¢ API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/ai/services` | GET | è·å–æ‰€æœ‰ AI æœåŠ¡çŠ¶æ€ |
| `/api/ai/switch-provider` | POST | åˆ‡æ¢ AI æœåŠ¡æä¾›è€… |
| `/api/ai/health` | GET | æ£€æŸ¥å½“å‰ AI æœåŠ¡å¥åº·çŠ¶æ€ |

### è‡ªåŠ¨å›é€€æœºåˆ¶

å½“ `LLM_AUTO_FALLBACK=true` (é»˜è®¤) æ—¶ï¼š
- å¦‚æœä¸»æœåŠ¡ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å°è¯•å¤‡ç”¨æœåŠ¡
- Ollama ä¸å¯ç”¨ â†’ å°è¯• Gemini
- Gemini API Key æœªé…ç½® â†’ å°è¯• Ollama

---

## ä¸‰ã€AI åŠŸèƒ½æŒ‰é’®è¯¦ç»†æ£€æµ‹

### 1. ğŸ·ï¸ é‡æ–°ç”Ÿæˆæ ‡ç­¾ (regenerateBeatTags)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `geminiService.ts` â†’ `apiClient.regenerateBeatTags()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/ai/generate-tags` |
| **åç«¯å®ç°** | `ai.py` â†’ `get_llm_provider().generate_beat_tags()` |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® AI |

**ä»£ç è·¯å¾„**:
```
å‰ç«¯: geminiService.ts:regenerateBeatTags() 
  â†’ apiClient.ts:regenerateBeatTags()
  â†’ POST /api/ai/generate-tags
åç«¯: ai.py:generate_tags()
  â†’ llm_provider.py:get_llm_provider().generate_beat_tags()
  â†’ OllamaProvider æˆ– GeminiProvider
```

---

### 2. ğŸ“ ç”Ÿæˆèµ„äº§æè¿° (generateAssetDescription)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `geminiService.ts` â†’ `apiClient.generateAssetDescription()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/ai/generate-description` |
| **åç«¯å®ç°** | `ai.py` â†’ `get_llm_provider().generate_asset_description()` |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® AI |

**ä»£ç è·¯å¾„**:
```
å‰ç«¯: geminiService.ts:generateAssetDescription()
  â†’ apiClient.ts:generateAssetDescription()
  â†’ POST /api/ai/generate-description
åç«¯: ai.py:generate_description()
  â†’ llm_provider.py:get_llm_provider().generate_asset_description()
  â†’ OllamaProvider æˆ– GeminiProvider
```

---

### 3. âœ‚ï¸ AI ç²—å‰ª (performAIRoughCut)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `Inspector.tsx` â†’ `handleAIRoughCut()` â†’ `geminiService.performAIRoughCut()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/ai/rough-cut` |
| **åç«¯å®ç°** | `ai.py` â†’ `get_llm_provider().analyze_rough_cut()` |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® AI |

**å‰ç«¯æŒ‰é’®ä½ç½®**: `Inspector.tsx` ç¬¬ 381 è¡Œ
```tsx
<button onClick={handleAIRoughCut} disabled={isAnalyzing}>
    <Wand2 size={10} /> æ ¹æ®å‰§æœ¬è‡ªåŠ¨è£å‰ª
</button>
```

**ä»£ç è·¯å¾„**:
```
å‰ç«¯: Inspector.tsx:handleAIRoughCut()
  â†’ geminiService.ts:performAIRoughCut()
  â†’ apiClient.ts:performAIRoughCut()
  â†’ POST /api/ai/rough-cut
åç«¯: ai.py:rough_cut_analysis()
  â†’ llm_provider.py:get_llm_provider().analyze_rough_cut()
  â†’ OllamaProvider æˆ– GeminiProvider
```

---

### 4. ğŸ‘ è®°å½•åé¦ˆ (recordAssetFeedback)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `Inspector.tsx` â†’ `handleAssetFeedback()` â†’ `geminiService.recordAssetFeedback()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/feedback/record` |
| **åç«¯å®ç°** | åé¦ˆè·¯ç”± (é AIï¼Œä½†ç”¨äº AI å­¦ä¹ ) |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® API |

---

### 5. ğŸ” AI æ™ºèƒ½åŒ¹é… (searchVisualAssets)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `Inspector.tsx` â†’ `handleSmartMatch()` â†’ `geminiService.searchVisualAssets()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/search/semantic` |
| **åç«¯å®ç°** | è¯­ä¹‰æœç´¢æœåŠ¡ |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® API |

**å‰ç«¯æŒ‰é’®ä½ç½®**: `Inspector.tsx` ç¬¬ 327 è¡Œ
```tsx
<button onClick={handleSmartMatch} disabled={isSearching}>
    <Sparkles size={10}/> AI æ™ºèƒ½åŒ¹é…
</button>
```

---

### 6. ğŸ“Š è§†é¢‘å†…å®¹åˆ†æ (analyzeVideoContent)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `geminiService.ts` â†’ `apiClient.analyzeVideoContent()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/assets/upload` + è½®è¯¢ `/api/assets/{id}/status` |
| **åç«¯å®ç°** | èµ„äº§å¤„ç†ç®¡é“ (è§†é¢‘åˆ†æ) |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® API |

---

### 7. ğŸ“œ å‰§æœ¬åˆ†æ (analyzeScriptToStructure)

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **å‰ç«¯å…¥å£** | `geminiService.ts` â†’ `api.remoteAnalyzeScript()` |
| **åç«¯ç«¯ç‚¹** | `POST /api/script/analyze` |
| **åç«¯å®ç°** | å‰§æœ¬åˆ†ææœåŠ¡ â†’ LLM Provider |
| **Mock æ•°æ®** | âŒ æ—  |
| **çŠ¶æ€** | âœ… è°ƒç”¨çœŸå® AI |

---

## å››ã€LLM Provider å®ç°æ£€æµ‹

### OllamaProvider (æœ¬åœ° AI - é»˜è®¤)

| æ–¹æ³• | å®ç°çŠ¶æ€ | è¯´æ˜ |
|------|----------|------|
| `generate_beat_tags()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Ollama API `/api/chat` |
| `generate_asset_description()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Ollama API `/api/chat` |
| `analyze_rough_cut()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Ollama API `/api/chat` |
| `analyze_script()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Ollama API `/api/chat` |
| `generate_demo_script()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Ollama API `/api/chat` |

**é…ç½®**:
- Base URL: `http://localhost:11434` (Ollama åŸç”Ÿ API)
- æ¨¡å‹: `qwen2.5:14b`
- è¶…æ—¶: 60 ç§’

### GeminiProvider (äº‘ç«¯ AI - å¤‡ç”¨)

| æ–¹æ³• | å®ç°çŠ¶æ€ | è¯´æ˜ |
|------|----------|------|
| `generate_beat_tags()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Gemini API |
| `generate_asset_description()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Gemini API |
| `analyze_rough_cut()` | âœ… çœŸå®å®ç° | è°ƒç”¨ Gemini API |
| `analyze_script()` | âœ… çœŸå®å®ç° | è°ƒç”¨ GeminiClient |
| `generate_demo_script()` | âœ… çœŸå®å®ç° | è°ƒç”¨ GeminiClient |

---

## äº”ã€å·²åˆ é™¤çš„ Mock æ–‡ä»¶

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `geminiService-backup.ts` | âœ… å·²åˆ é™¤ | åŒ…å« `mockDelay()` ç­‰ mock å‡½æ•° |

---

## å…­ã€å‰ç«¯ API è°ƒç”¨é“¾è·¯éªŒè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ç»„ä»¶å±‚                                â”‚
â”‚  Inspector.tsx / StepLibrary.tsx / StepBeatBoard.tsx           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     geminiService.ts                            â”‚
â”‚  (æœåŠ¡æŠ½è±¡å±‚ - æ—  Mock æ•°æ®)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      apiClient.ts                               â”‚
â”‚  (HTTP å®¢æˆ·ç«¯ - è°ƒç”¨åç«¯ API)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ FastAPI                                 â”‚
â”‚  /api/ai/generate-tags                                          â”‚
â”‚  /api/ai/generate-description                                   â”‚
â”‚  /api/ai/rough-cut                                              â”‚
â”‚  /api/ai/health                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    llm_provider.py                              â”‚
â”‚  get_llm_provider() â†’ OllamaProvider / GeminiProvider          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     çœŸå® AI æœåŠ¡                                 â”‚
â”‚  Ollama (æœ¬åœ°) / Gemini (äº‘ç«¯)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€ç»“è®º

### âœ… æ‰€æœ‰ AI åŠŸèƒ½æŒ‰é’®å‡å·²æ­£ç¡®é…ç½®

1. **å‰ç«¯æ—  Mock æ•°æ®**: `geminiService.ts` å’Œ `apiClient.ts` å‡é€šè¿‡ HTTP è°ƒç”¨åç«¯ API
2. **åç«¯æ— ç¡¬ç¼–ç è¿”å›**: `ai.py` è·¯ç”±å…¨éƒ¨è°ƒç”¨ `LLMProvider` æŠ½è±¡å±‚
3. **LLM Provider å®Œæ•´å®ç°**: 
   - `OllamaProvider`: è°ƒç”¨æœ¬åœ° Ollama API
   - `GeminiProvider`: è°ƒç”¨ Google Gemini API
4. **é…ç½®çµæ´»**: é€šè¿‡ç¯å¢ƒå˜é‡ `LLM_PROVIDER` åˆ‡æ¢ AI åç«¯

### ğŸ“‹ AI æŒ‰é’®æ¸…å•

| # | æŒ‰é’®åç§° | ä½ç½® | åç«¯ç«¯ç‚¹ | çŠ¶æ€ |
|---|----------|------|----------|------|
| 1 | é‡æ–°ç”Ÿæˆæ ‡ç­¾ | BeatBoard | `/api/ai/generate-tags` | âœ… çœŸå® AI |
| 2 | ç”Ÿæˆèµ„äº§æè¿° | Library | `/api/ai/generate-description` | âœ… çœŸå® AI |
| 3 | AI ç²—å‰ª | Inspector | `/api/ai/rough-cut` | âœ… çœŸå® AI |
| 4 | AI æ™ºèƒ½åŒ¹é… | Inspector | `/api/search/semantic` | âœ… çœŸå® API |
| 5 | è®°å½•åé¦ˆ | AssetWall | `/api/feedback/record` | âœ… çœŸå® API |
| 6 | è§†é¢‘åˆ†æ | Library | `/api/assets/upload` | âœ… çœŸå® API |
| 7 | å‰§æœ¬åˆ†æ | Analysis | `/api/script/analyze` | âœ… çœŸå® AI |

---

**æ£€æµ‹å®Œæˆ** âœ…
