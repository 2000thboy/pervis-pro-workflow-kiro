# 核心逻辑与技术路径修正 (Correction & Confirmation)

## 1. 关于视频 AI 分析的真实路径 (Video AI Path)

**您问：我们每次都发送给 Gemini Vision 吗？不可能上传几百 G 的视频吧？**

### 👨‍💻 技术总监 (TD) 回答：
**绝对不可能，也是绝对禁止的。**
如果直接上传几百 G 的 ProRes 素材，带宽成本和 API 费用瞬间就会爆炸，且速度极慢。

**✅ 我们的真实技术路径 (The Real Workflow)**：
这就是启动器端 **"预处理 (Pre-processing)"** 的核心价值。

1.  **本地切片 (Local Slicing)**:
    *   在您的电脑/服务器上，`ffmpeg` 就像一把手术刀。
    *   它**不上传**视频，而是每隔 N 秒（比如 2 秒或 5 秒）在本地截取一张清晰的 **JPG 图片 (Keyframe)**。
2.  **只传图片 (Images Only)**:
    *   我们只把这些 **几百 KB 大小** 的 JPG 图片发送给 Gemini Vision。
    *   **Prompt**: "这是视频的第 10 秒、第 15 秒的画面，请告诉我发生了什么..."
3.  **结果合成**:
    *   AI 返回每一帧的描述，后台将它们串联成整个视频的分析报告。

**结论**：不管原素材是 100G 还是 1T，我们上传的数据量永远只有 **几十 MB (图片)**。这是行业标准方案。

---

## 2. 关于 "2分钟分场" 的逻辑修正 (Script Logic Correction)

**您指出：超过两分钟要人工分场，是在"剧本环节"，而不是"Beatboard 环节"。**

### 👨‍💼 产品经理 (PM) 回答：
**非常敏锐的纠正。这个逻辑位置的调整，直接决定了工作流的顺畅度。**

**❌ 修正前的错误理解**:
*   AI 先傻傻地把剧本全拆成 Beat，然后在 Beatboard 上发现 "哇，这一条有 5 分钟"，然后再让用户去拆。
*   *后果：用户已经在修房子了，才发现地基太大，返工成本高。*

**✅ 修正后的正确逻辑 (Script Import Stage)**:
*   **时机**: 当您把 TXT/PDF 扔进系统的 **第一秒** (Import 阶段)。
*   **强校验 (Validator)**:
    *   系统在解析文本时，立刻计算每一场戏的预估时长。
    *   **触发阈值**: 发现 `SCENE 8` 估算时长 = 180s (> 120s)。
*   **阻断式交互 (Blocking Prompt)**:
    *   系统**暂停**分析，弹窗警告：
    *   *"第 8 场戏预估过长 (3分钟)，建议您现在进行拆分，否则后续生成的 Beat 会过于笼统。"*
    *   **操作**: 提供一个简单的文本分割框，用户在这里加一个回车，打上 `SCENE 8B`，问题直接在源头解决。

---

## 📋 更新后的 Planlist

### 1. 预处理模块 (Visual Processor)
- [ ] **实现抽帧逻辑**: 确保 `visual_processor.py` 真的在做 `extract_keyframes`，而不是发伪造请求。
- [ ] **优化 Token**: 限制发给 Gemini 的图片数量 (比如每场戏只发 5 张关键图)，平衡精度与成本。

### 2. 剧本解析模块 (Script Parser)
- [ ] **前置检查**: 在 `analyze_script` 之前增加 `pre_validate_script`。
- [ ] **时长估算器**: 写死算法 (1行 ≈ 3秒)，不依赖 AI，快速识别长段落。
- [ ] **拆分 UI**: 前端增加 "剧本预检查" 弹窗，处理超长场次。
