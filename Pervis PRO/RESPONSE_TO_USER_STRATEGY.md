# Pervis PRO - 产品与技术战略回复 (Product & Tech Strategy Response)

**日期**: 2025-12-20
**致**: 核心用户 (Director Level)

---

## 1. 紧急修复方案 (P0 Incident Response)

**问题描述**: 启动后浏览器显示 "无法访问此网站 (ERR_CONNECTION_REFUSED)"，端口 5173 拒绝连接。
**根本原因 (Root Cause)**: 
*   前端代码 (`vite.config.ts`) 明确配置了在 **3000 端口** 运行，作为生产环境的标准端口。
*   但启动器 (`ProcessManager`) 的自动打开浏览器逻辑中保留了开发环境默认的 **5173 端口**。
*   **结论**: 这是一个典型的 "配置偏离 (Configuration Drift)" 问题。服务开在了 3000，但浏览器去访问 5173，导致用户看着白屏以为服务挂了。

**解决方案**:
*   ✅ **Fixed**: 已修正启动器代码，将目标端口强制对齐为 `3000`。
*   **Action**: 您下次启动时，浏览器将正确跳转至 **http://localhost:3000**。

---

## 2. 关于 "记忆" 的深度对话 (Deep Dive on Memory)

您提出了一个极其敏锐的技术洞察：
> **"我们不是已经有视频的预处理吗？不是应该有预处理的文件作为记忆吗？"**

作为**技术总监 (TD)**，我必须向您解释 "存储 (Storage)" 与 "记忆 (Memory)" 的本质区别，以及为什么我们现在的架构需要进化。

### 现在的状态：它是 "书架" (Storage)
我们现在的 `VisualProcessor` 确实工作了。它看视频，提取特征，并在内存里计算。
*   **预处理文件**: 我们有 `proxies/` (代理视频) 和 `thumbnails/` (缩略图)。
    *   *这些是物理文件。它们是给人看的，不是给 AI 用的。*
*   **特征文件**: 我们即使把计算出的向量保存成 `.npy` 或 `.json` 文件存在硬盘上，它也只是**冷数据**。
    *   *想象一下*：如果我们要搜 "悲伤的雨天"，AI 必须把硬盘里 1000 个视频对应的 json 文件全部读进内存，一个个计算距离。这在 10 个视频时很快，但在 1000 个视频时会**卡顿**，在 10000 个视频时会**崩溃**。

### 下一步的目标：它是 "大脑" (Vector Memory)
这也是为什么我在 v0.3.1 规划中强调 **ChromaDB**。
*   **索引 (Index)**: 向量数据库不是简单的存文件。它构建了一个高维空间的 HNSW 索引（类似图书馆的分类索引卡片）。
*   **毫秒级召回**: 当您搜 "雨天" 时，AI 不需要遍历所有文件。它直接在索引中定位到坐标，**0.01秒** 内就抓出最接近的 10 个镜头。
*   **持久化**: 哪怕电脑重启，这个高维索引依然存在。

**结论**: 
目前的"预处理文件"只是**素材的尸体**。
只有引入向量库（Vector DB），我们才能注入**灵魂**，让这些死文件变成可以被毫秒级检索的**活记忆**。

---

## 3. 技术实施计划清单 (Plan List) - Next Steps

基于您的要求，这是接下来的具体执行清单：

### Phase 3.1: 修复与验证 (Immediate)
- [x] **Fix Login**: 修正 ProcessManager 端口指向 (3000)。
- [ ] **Verify**: 确保前端页面能够正确显示。

### Phase 3.2: 记忆层构建 (Memory Construction)
这是回答您 "记忆" 问题的核心实施路径：

| 步骤 | 动作 (Action) | 交付物 (Deliverable) | 备注 |
| :--- | :--- | :--- | :--- |
| **1** | **安装 ChromaDB** | `backend/services/memory_store.py` | 建立 "海马体" (已安装依赖) |
| **2** | **向量入库 (Ingestion)** | `AssetProcessor.index_asset()` | 修改扫描逻辑，将 CLIP 算出的 512维向量写入 ChromaDB |
| **3** | **持久化验证** | `verify_memory.py` | 重启 App 后，验证之前算的向量是否还在 |

### Phase 3.3: 搜索层暴露 (Search UI)
| 步骤 | 动作 (Action) | 交付物 (Deliverable) | 备注 |
| :--- | :--- | :--- | :--- |
| **4** | **API 升级** | `POST /api/search/semantic` | 接收文本 -> 转化为向量 -> 查询 ChromaDB -> 返回 AssetID |
| **5** | **UI 适配** | 前端搜索框支持自然语言输入 | "找素材" -> "找感觉" 的交互质变 |

**建议**: 请批准执行 Phase 3.1 修复，随后立即进入 Phase 3.2 记忆层构建。
