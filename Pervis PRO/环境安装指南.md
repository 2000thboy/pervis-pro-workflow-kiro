# Pervis PRO 环境安装指南

## 快速安装

### 方法一：自动安装脚本（推荐）

**Windows 用户：**
```powershell
# 在项目根目录运行
.\setup_environment.ps1
```

**所有平台：**
```bash
# 在项目根目录运行
python setup_environment.py
```

### 方法二：手动安装

## 1. 基础环境要求

### 必需组件
- **Python 3.10+** - [下载地址](https://www.python.org/downloads/)
  - 安装时请勾选 "Add Python to PATH"
- **Node.js 18+** - [下载地址](https://nodejs.org/)
- **Git** - [下载地址](https://git-scm.com/)

### 推荐组件
- **FFmpeg** - 视频处理必需
  - Windows: [下载地址](https://www.ffmpeg.org/download.html) 或 `choco install ffmpeg`
  - macOS: `brew install ffmpeg`
  - Linux: `sudo apt install ffmpeg`

## 2. 项目依赖安装

### 后端环境
```bash
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
.\venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 安装依赖
pip install --upgrade pip
pip install -r requirements.txt
```

### 前端环境
```bash
cd frontend
npm install
```

### 启动器依赖
```bash
# 在项目根目录
pip install customtkinter pillow
```

## 3. 配置文件设置

### 创建 backend/.env 文件
```env
# AI 配置
GEMINI_API_KEY=your_gemini_api_key_here
LLM_PROVIDER=gemini

# 数据库配置
DATABASE_URL=sqlite:///./pervis_director.db

# 存储配置
ASSET_ROOT=./storage/assets
STORAGE_ROOT=./storage
```

### 获取 Gemini API 密钥
1. 访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 创建新的 API 密钥
3. 将密钥添加到 `.env` 文件中

## 4. 可选组件

### Ollama（本地 AI）
如果想使用本地 AI 模型：
1. 下载安装 [Ollama](https://ollama.com)
2. 安装模型：`ollama pull qwen2.5:14b`
3. 修改 `.env`：`LLM_PROVIDER=local`

### Redis（任务队列）
用于异步视频处理：
- Windows: [下载地址](https://redis.io/download)
- macOS: `brew install redis`
- Linux: `sudo apt install redis-server`

## 5. 验证安装

### 检查环境
```bash
# 检查 Python
python --version

# 检查 Node.js
node --version

# 检查 FFmpeg
ffmpeg -version

# 检查 Git
git --version
```

### 启动项目
```bash
# 使用启动器（推荐）
python 启动_Pervis_PRO.py

# 或手动启动
# 终端1 - 后端
cd backend
python -m uvicorn main:app --reload --port 8000

# 终端2 - 前端
cd frontend
npm run dev
```

## 6. 常见问题

### Python 相关
- **问题**: `python` 命令未找到
- **解决**: 确保 Python 已添加到 PATH，或使用 `python3`

### Node.js 相关
- **问题**: `npm install` 失败
- **解决**: 尝试清除缓存 `npm cache clean --force`

### FFmpeg 相关
- **问题**: 视频处理失败
- **解决**: 确保 FFmpeg 已正确安装并添加到 PATH

### 权限问题
- **Windows**: 以管理员身份运行 PowerShell
- **macOS/Linux**: 使用 `sudo` 或检查文件权限

## 7. 开发环境

### IDE 推荐
- **VS Code** + Python + TypeScript 扩展
- **PyCharm Professional**

### 调试配置
项目包含 `.vscode/launch.json` 配置文件，支持：
- 后端 FastAPI 调试
- 前端 React 调试

## 8. 部署准备

### 生产环境依赖
```bash
# 后端生产依赖
pip install gunicorn

# 前端构建
cd frontend
npm run build
```

### 环境变量
生产环境需要设置：
- `DATABASE_URL`: 生产数据库连接
- `GEMINI_API_KEY`: API 密钥
- `ASSET_ROOT`: 资源存储路径
- `STORAGE_ROOT`: 数据存储路径

---

## 技术支持

如果遇到安装问题，请检查：
1. 系统版本兼容性
2. 网络连接状态
3. 防火墙/杀毒软件设置
4. 磁盘空间是否充足

更多技术细节请参考项目文档。